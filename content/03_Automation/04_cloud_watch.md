---
title: "Visibility with CloudWatch"
chapter: false
weight: 90
---

### Monitoring your Scans with CloudWatch

File Storage Security logs are stored in CloudWatch Logs, which contain a bit more information than what’s available in the  ```fss-* tags```.

To view the scan result logs in CloudWatch Logs, go to your AWS account, and click the following: CloudFormation > select your scanner stack > Resources > ScannerLogGroup. 

![Diagram](/images/fss-monitoring-cloudwatch.png)

You’ll see the CloudWatch service appears on the left with log groups selected.

Under log streams, click on a log stream with a latest event time that is later or equal to the time that you added the file to the Amazon S3 bucket to scan. Next, expand the event message that starts with scanner result.

A JSON code block appears containing information about the scan, such as:

* <b>timestamp</b>: A unique number that corresponds to the time when the scan occurred.
* <b>sqs-message-id</b>: The unique ID of this event.
* <b>file_url</b>: The URL to the scanned file in Amazon S3.
* <b>scanner_status and scanner_status_message</b>

![Diagram](/images/fss-cloudwatchevent.png)

This pairing has the following values:

* <b>0</b>:  "successful scan": Indicates that the scan finished successfully.

* <b>-1</b>: "invalid license status": Usually indicates that File Storage Security is not fully configured. The most likely reason for an incomplete configuration is that ARNs have not been submitted through the File Storage Security console or API yet. For instructions on submitting the ARNs, see Add Stacks or Deploy Stacks using the API. This message could also indicate that your license is not valid, or that File Storage Security was not able to push a new license to your stack.

* <b>-2</b>: "unsuccessful scan": Indicates that an internal error occurred in the ScannerLambda function.

* <b>-3</b>: "scanner error": Indicates that an internal error occurred in the ScannerLambda function.

* <b>-4</b>: "unsuccessful scanner invocation": Indicates that the ScannerLambda function couldn’t finish the scan. Either the scan timeout was reached, or there were too many files to scan causing a Lambda throttling error. scanning_result: Indicates scan details such as the scanned file’s size as well as any found malware or errors.

You can search for scan results using CloudWatch Logs Insights. Below is an example of how to set up a query.

In AWS, go to the CloudWatch service. On the left, under Logs, click Insights. On the main pane, click inside the Select log group(s) field, and enter ScannerLambda into the search box. Select the File Storage Security log group. It looks similar to:

```
/aws/lambda/FileStorageSec-ScannerLambda
```

Replace the contents of the text box with the following lines and click in <b>Run Query</b>:

```
fields @timestamp, @message
| filter @message like "scanner result"
| sort @timestamp desc
| limit 20
```
{{% notice info %}}
This query finds all scan results, up to a maximum of 20.<br/>
Set the time or date range using the available buttons.<br/>
If you were expecting results and don't see them, try setting a broader time or date range.
{{% /notice %}}

You should be able to see the events that you generated:

![Diagram](/images/cw.png)

By expanding the details of the event, you will be able to see the event detail generated by File Storage Security in a JSON format:

```
scanner result: {
	"timestamp": 1615275981.7993867,
	"sqs_message_id": "6ac6dc98-d56a-494f-bef2-10684fc53501",
	"file_url": "https://my-fss-demo.s3.us-east-2.amazonaws.com/eicar.com",
	"scanner_status": 0,
	"scanner_status_message": "successful scan",
	"scanning_result": {
		"TotalBytesOfFile": 68,
		"Findings": [{
			"malware": "Eicar_test_file",
			"type": "Virus"
		}],
		"Error": ""
	}
}
```

You did it :tada:!

Now that you know how to verify File Storage Security logs and events in CloudWatch you can create your own automations based on CloudWatch data :rocket: